<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>
    {% if page.title %}
      {{ page.title }} - {{ site.name }}
    {% else %}
      {{ site.name }}
    {% endif %}
    </title>
    <meta name="description" content="{{ site.meta_description}}" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@site_username">
    <meta name="twitter:creator" content="@creator_username">
    {% if page.title %}
      <meta name="twitter:title" content="{{ page.title }}">
    {% else %}
      <meta name="twitter:title" content="{{ site.title }}">
    {% endif %}
    {% if page.url %}
      <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    {% endif %}
    {% if page.description %}
      <meta name="twitter:description" content="{{ page.description }}">
    {% else %}
      <meta name="twitter:description" content="{{ site.description }}">
    {% endif %}

    <link rel="stylesheet" href="/dest/main.min.css" />
  </head>
  <body class="avenir f5">
    {% include main-header.html %}
    {% include intro-line.html %}
    <main {% unless page.free_layout %} class="ph3 ph5-ns" {% endunless %}>
      {{ content }}
    </main>
    {% include main-footer.html %}

    <script src="/assets/js/echo.js"></script>
    <script src="https://unpkg.com/simple-jekyll-search@latest/dest/jekyll-search.min.js" type="text/javascript"></script>

    <script>
      echo.init({
        offset: 100,
        throttle: 250,
        unload: false
      });

      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
        searchResultTemplate: '<li><a class="pa" href="{{ site.url }}{url}">{title}</a></li>',
      })
    </script>
    <script>
      var mainHeader = document.querySelector('.main-header')
      var introLine = document.querySelector('.intro-line')
      var socialLinks = document.querySelector('.social-links')

      positionSocialLinks()

      window.addEventListener('scroll', positionSocialLinks)
      function positionSocialLinks () {
        var topPadding = 100
        var inView = isScrolledIntoView(socialLinks, topPadding)
        var method = inView ? 'remove' : 'add'
        var invertColor = inView ? 'add' : 'remove'
        socialLinks.classList[method]('fixed')
        socialLinks.classList[method]('black')
        socialLinks.classList[invertColor]('white')
      }

      function isScrolledIntoView (element, topPadding) {
        topPadding = topPadding || 0
        var scrollTop = document.body.scrollTop
        var height = scrollTop + window.innerHeight

        var elementTop = rect(element).top
        var elemBottom = elementTop + rect(element).height

        return ((elemBottom <= height) && (elementTop + topPadding >= scrollTop))
      }

      var searchInput = document.getElementById('search-input')
      var searchIsActive = false
      var searchBlinkTimer = 0
      var typingText = '...'
      var slashToSearchText = 'Type / to search'
      var trackedKeys = []
      searchInput.setAttribute('placeholder', slashToSearchText)

      window.addEventListener('keyup', function (event) {
        track(event.keyCode)
        if (searchActiveCombo()) {
          searchIsActive = true
          searchInput.focus()
        } else {
          searchIsActive = false
        }
      })

      searchInput.addEventListener('blur', function () {
        clearInterval(searchBlinkTimer)
        searchInput.setAttribute('placeholder', slashToSearchText)
      })
      searchInput.addEventListener('focus', function () {
        updateWithNextText()

        searchBlinkTimer = setInterval(updateWithNextText, 200)
      })




      function rect (element) {
        return element.getBoundingClientRect()
      }



      function track (key) {
        trackedKeys.unshift(key)
        trackedKeys.length = 2
      }

      function searchActiveCombo() {
        var sevenKey = 55
        var shiftKey = 16
        return trackedKeys[0] === shiftKey && trackedKeys[1] === sevenKey
      }

      function nextText (currentText) {
        var currentLength = currentText.length
        var remainingText = typingText.slice(currentLength)
        return remainingText.length === 0 ? '' : currentText + remainingText[0]
      }
      function updateWithNextText () {
        searchInput.setAttribute('placeholder', nextText(searchInput.getAttribute('placeholder')))
      }
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57238829-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
