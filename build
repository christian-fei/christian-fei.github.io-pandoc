#!/bin/bash

BULMA_CSS_MIN=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css
MAIN_CSS=main.css
HTML_TEMPLATE=templates/html.template
PANDOC_PARAMS="--atx-headers --css=$BULMA_CSS_MIN --css=/$MAIN_CSS --template=./$HTML_TEMPLATE --from markdown --to=html5 --standalone -H header.html --metadata-file=posts/index.yml"

pandoc $PANDOC_PARAMS index.md -o index.html
pandoc $PANDOC_PARAMS about.md -o about.html
mkdir -p about
pandoc $PANDOC_PARAMS about.md -o about/index.html

mkdir -p posts

echo "posts: " > posts/index.yml

for file in posts/*.md
do
  if [[ -f $file ]]; then
    name=$(basename ${file%.*})
    echo "  - $name" >> posts/index.yml
  fi
done

for file in posts/*.md
do
  if [[ -f $file ]]; then
    name=$(basename ${file%.*})
    mkdir -p posts/$name
    pandoc -t=$HTML_TEMPLATE --metadata-file=posts/index.yml $PANDOC_PARAMS posts/$name.md -o posts/$name/index.html
    pandoc -t=$HTML_TEMPLATE --metadata-file=posts/index.yml $PANDOC_PARAMS posts/$name.md -o posts/$name.html
  fi
done
